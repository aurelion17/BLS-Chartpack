---
title: "Bank Lending Survey Chartpack"
author: "Aurelio Nocera & Sorcha Foster"
date: "`r format(Sys.time(),'%d %B %Y')`"
output:
  html_document:
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
    toc_depth: 3
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.align='center',echo = FALSE,warning = FALSE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 

```

The **euro area bank lending survey (BLS)** provides information on bank lending conditions in the euro area. 
It supplements existing statistics with information on the *supply of, and demand for, loans to enterprises and households*. The BLS provides input to the assessment of monetary and economic developments carried out by the Governing Council of the European Central Bank (ECB), which feeds into the monetary policy decision-making process.

The BLS is conducted four times a year. *It is usually published in January, April, July and October.*

(**Source: ECB Website** [link](https://www.ecb.europa.eu/stats/ecb_surveys/bank_lending_survey/html/index.en.html))

```{r}
#--------------------------------------------------------------------------
# Script by Sorcha Foster 02/04/2024
# Update by Aurelio Nocera
# Transmission data for briefing 
#--------------------------------------------------------------------------

## Packages loading 

require("data.table")
require("tidyr")
require("purrr")
require("dplyr")
require("xlsx")
require("zoo")
require("ggplot2")
library(glue)
library(httr)
library(curl)
library(lubridate)

### Set your working directory
setwd("C:/Users/anocera/Desktop/Personal/Projects/BLS") 

# List of countries that now belong to the Euro Area, including EuroArea reference "U2"
ea = c("AT", "BE", "CY", "DE", "EE", "HR","IE", "FR", "GR", "IT", "LT", "LV", 
       "LU", "SI", "SK", "FI", "NL", "ES", "PT", "U2", "MT")

#Set proxies - VERY IMPORTANT IN THE BANK ELSE WILL NOT WORK
proxy_url <- "http://10.15.11.225:8080"
Sys.setenv(http_proxy = proxy_url, https_proxy = proxy_url, ftp_proxy = proxy_url)

## Define your IAM credentials (Note this is Darwin log in details if different from SDW)
euaccount="IEANOCERA"
password="TempPass24%"

## Define format for data i.e. accept text or csv files from API
headers = c(`Accept` = 'text/csv')

# Combine the protocol wsEntryPoint and resource
source ="https://esb-ws-scde.eu.escb.eu/ws/SDW21/REST/service/data/BLS_RESTR/"

date_convert = function(data){
  data = data %>%
    mutate(date = as_date(as.yearqtr(df$TIME_PERIOD, format = "%Y-Q%q")))
  return(data)
}

```

# Section 1 Firms 

## SubSection 1.1: Credit Standards (Q2 2024)

### Euro Area, full series (Q2 2024)

```{r}

# Euro area Bank Lending Survey 

# FIRM CREDIT STANDARDS - EURO AREA, "U2"
# Effect domain: Credit Standards (ST), BLS contract counterpart: enterprises (E); BLS counterpart motivation (Z): not applicable
# Market role: loan supply (S)
# weighted net percentage (tighntened minus eased or reverse), based on the share of each bank in the total loan outstanding amount of the banks in the BLS sample

series_key <- "Q.U2.ALL..E.Z..ST.S.WFNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_cstd = date_convert(bls_firm_cstd)

bls_firm_cstd= bls_firm_cstd%>%
  filter(BLS_ITEM=="O")%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_firm_cstd,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Euro Area, Credit Standards/Firms, full time series")+
  theme_bw()

write.csv(bls_firm_cstd, "EA_CrS_Firms.csv")

```

### Euro Area, breakdown (Q2 2024)

```{r}

# Euro area Bank Lending Survey 

# FIRM CREDIT STANDARDS - EURO AREA, "U2"
# Effect domain: Credit Standards (ST), BLS contract counterpart: enterprises (E); BLS counterpart motivation (Z): not applicable
# Market role: loan supply (S)
# weighted net percentage (tighntened minus eased or reverse), based on the share of each bank in the total loan outstanding amount of the banks in the BLS sample

series_key <- "Q.U2.ALL..E.Z..ST.S.WFNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_cstd = date_convert(bls_firm_cstd)

bls_firm_cstd1= bls_firm_cstd%>%
  filter(BLS_ITEM=="O")%>%
  mutate(Date=date-months(3))%>%
  select(Date,TIME_HORIZON,OBS_VALUE)%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  filter(Date>="2020-01-01")

factors = c("BC", "CP", "GEA", "IFO", "LP", "MF", "MFC", "NBC", "RCD", "RTO")

bls_firm_cstd = bls_firm_cstd  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, CP, na.rm = T)/3, 
         "Risk perceptions" = sum(GEA, RCD, IFO, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, MFC, na.rm = T)/3, 
         "Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "RCD", "IFO", "NBC", "BC", "MFC", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))

bls_firm_cstd<-bls_firm_cstd%>%
  mutate(Factors=BLS_ITEM)%>%
  select(Date,Factors,value)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_firm_cstd,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_firm_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Euro Area, Credit Standards/Firms, breakdown factors, full time series")+
  theme_bw()

```

### France, full series (Q2 2024)

```{r}

# FIRM CREDIT STANDARDS - France, FR
# Effect domain: Credit Standards (ST), BLS contract counterpart: enterprises (E); BLS counterpart motivation (LE):large enterprises
# Market role: loan supply (S)
# weighted net percentage (tightened minus eased or reverse), based on the share of each bank in the total loan outstanding amount of the banks in the BLS sample

series_key <- "Q.FR.ALL..E.Z..ST.S.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_cstd = date_convert(bls_firm_cstd)

bls_firm_cstd= bls_firm_cstd%>%
  filter(BLS_ITEM=="O")%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_firm_cstd,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("France, Credit Standards/Firms, full time series")+
  theme_bw()

write.csv(bls_firm_cstd, "FR_CrS_Firms.csv")
```

### France, breakdown (Q2 2024)

```{r}

# FIRM CREDIT STANDARDS - France, FR
# Effect domain: Credit Standards (ST), BLS contract counterpart: enterprises (E); BLS counterpart motivation (LE):large enterprises
# Market role: loan supply (S)
# weighted net percentage (tightened minus eased or reverse), based on the share of each bank in the total loan outstanding amount of the banks in the BLS sample

series_key <- "Q.FR.ALL..E.Z..ST.S.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_cstd = date_convert(bls_firm_cstd)

bls_firm_cstd1= bls_firm_cstd%>%
  filter(BLS_ITEM=="O")%>%
  mutate(Date=date-months(3))%>%
  select(Date,TIME_HORIZON,OBS_VALUE)%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  filter(Date>="2020-01-01")

factors = c("BC", "CP", "GEA", "IFO", "LP", "MF", "MFC", "NBC", "RCD", "RTO")

bls_firm_cstd = bls_firm_cstd  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, CP, na.rm = T)/3, 
         "Risk perceptions" = sum(GEA, RCD, IFO, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, MFC, na.rm = T)/3, 
         "Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "RCD", "IFO", "NBC", "BC", "MFC", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))

bls_firm_cstd<-bls_firm_cstd%>%
  mutate(Factors=BLS_ITEM)%>%
  select(Date,Factors,value)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_firm_cstd,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_firm_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("France, Credit Standards/Firms, breakdown factors, full time series")+
  theme_bw()

```


### Germany, full series (Q2 2024) 

```{r}

# FIRM CREDIT STANDARDS - Germany
# Effect domain: Credit Standards (ST), BLS contract counterpart: enterprises (E); BLS counterpart motivation (LE):large enterprises
# Market role: loan supply (S)
# weighted net percentage (tightened minus eased or reverse), based on the share of each bank in the total loan outstanding amount of the banks in the BLS sample

series_key <- "Q.DE.ALL..E.Z..ST.S.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_cstd = date_convert(bls_firm_cstd)

bls_firm_cstd= bls_firm_cstd%>%
  filter(BLS_ITEM=="O")%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_firm_cstd,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Germany, Credit Standards/Firms, full time series")+
  theme_bw()

write.csv(bls_firm_cstd, "DE_CrS_Firms.csv")

```

### Germany, breakdown (Q2 2024)

```{r}
# FIRM CREDIT STANDARDS - Germany,DE
# Effect domain: Credit Standards (ST), BLS contract counterpart: enterprises (E); BLS counterpart motivation (LE):large enterprises
# Market role: loan supply (S)
# weighted net percentage (tightened minus eased or reverse), based on the share of each bank in the total loan outstanding amount of the banks in the BLS sample

series_key <- "Q.DE.ALL..E.Z..ST.S.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_cstd = date_convert(bls_firm_cstd)

bls_firm_cstd1= bls_firm_cstd%>%
  filter(BLS_ITEM=="O")%>%
  mutate(Date=date-months(3))%>%
  select(Date,TIME_HORIZON,OBS_VALUE)%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  filter(Date>="2020-01-01")

factors = c("BC", "CP", "GEA", "IFO", "LP", "MF", "MFC", "NBC", "RCD", "RTO")

bls_firm_cstd = bls_firm_cstd  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, CP, na.rm = T)/3, 
         "Risk perceptions" = sum(GEA, RCD, IFO, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, MFC, na.rm = T)/3, 
         "Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "RCD", "IFO", "NBC", "BC", "MFC", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))

bls_firm_cstd<-bls_firm_cstd%>%
  mutate(Factors=BLS_ITEM)%>%
  select(Date,Factors,value)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_firm_cstd,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_firm_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Germany, Credit Standards/Firms, breakdown factors, full time series")+
  theme_bw()

```

### Italy, full series (Q2 2024) 

```{r}

# FIRM CREDIT STANDARDS - Italy
# Effect domain: Credit Standards (ST), BLS contract counterpart: enterprises (E); BLS counterpart motivation (LE):large enterprises
# Market role: loan supply (S)
# weighted net percentage (tightened minus eased or reverse), based on the share of each bank in the total loan outstanding amount of the banks in the BLS sample

series_key <- "Q.IT.ALL..E.Z..ST.S.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_cstd = date_convert(bls_firm_cstd)

bls_firm_cstd= bls_firm_cstd%>%
  filter(BLS_ITEM=="O")%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_firm_cstd,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Italy, Credit Standards/Firms, full time series")+
  theme_bw()

write.csv(bls_firm_cstd, "IT_CrS_Firms.csv")

```

### Italy, breakdown (Q2 2024)

```{r}
# FIRM CREDIT STANDARDS - Italy,IT
# Effect domain: Credit Standards (ST), BLS contract counterpart: enterprises (E); BLS counterpart motivation (LE):large enterprises
# Market role: loan supply (S)
# weighted net percentage (tightened minus eased or reverse), based on the share of each bank in the total loan outstanding amount of the banks in the BLS sample

series_key <- "Q.IT.ALL..E.Z..ST.S.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_cstd = date_convert(bls_firm_cstd)

bls_firm_cstd1= bls_firm_cstd%>%
  filter(BLS_ITEM=="O")%>%
  mutate(Date=date-months(3))%>%
  select(Date,TIME_HORIZON,OBS_VALUE)%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  filter(Date>="2020-01-01")

factors = c("BC", "CP", "GEA", "IFO", "LP", "MF", "MFC", "NBC", "RCD", "RTO")

bls_firm_cstd = bls_firm_cstd  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, CP, na.rm = T)/3, 
         "Risk perceptions" = sum(GEA, RCD, IFO, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, MFC, na.rm = T)/3, 
         "Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "RCD", "IFO", "NBC", "BC", "MFC", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))

bls_firm_cstd<-bls_firm_cstd%>%
  mutate(Factors=BLS_ITEM)%>%
  select(Date,Factors,value)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_firm_cstd,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_firm_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Italy, Credit Standards/Firms, breakdown factors, full time series")+
  theme_bw()

```


### Spain, full series (Q2 2024) 

```{r}

# FIRM CREDIT STANDARDS - Spain
# Effect domain: Credit Standards (ST), BLS contract counterpart: enterprises (E); BLS counterpart motivation (LE):large enterprises
# Market role: loan supply (S)
# weighted net percentage (tightened minus eased or reverse), based on the share of each bank in the total loan outstanding amount of the banks in the BLS sample

series_key <- "Q.ES.ALL..E.Z..ST.S.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_cstd = date_convert(bls_firm_cstd)

bls_firm_cstd= bls_firm_cstd%>%
  filter(BLS_ITEM=="O")%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_firm_cstd,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Spain, Credit Standards/Firms, full time series")+
  theme_bw()

write.csv(bls_firm_cstd, "ES_CrS_Firms.csv")

```

### Spain, breakdown (Q2 2024)

```{r}
# FIRM CREDIT STANDARDS - Spain,ES
# Effect domain: Credit Standards (ST), BLS contract counterpart: enterprises (E); BLS counterpart motivation (LE):large enterprises
# Market role: loan supply (S)
# weighted net percentage (tightened minus eased or reverse), based on the share of each bank in the total loan outstanding amount of the banks in the BLS sample

series_key <- "Q.ES.ALL..E.Z..ST.S.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_cstd = date_convert(bls_firm_cstd)

bls_firm_cstd1= bls_firm_cstd%>%
  filter(BLS_ITEM=="O")%>%
  mutate(Date=date-months(3))%>%
  select(Date,TIME_HORIZON,OBS_VALUE)%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  filter(Date>="2020-01-01")

factors = c("BC", "CP", "GEA", "IFO", "LP", "MF", "MFC", "NBC", "RCD", "RTO")

bls_firm_cstd = bls_firm_cstd  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, CP, na.rm = T)/3, 
         "Risk perceptions" = sum(GEA, RCD, IFO, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, MFC, na.rm = T)/3, 
         "Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "RCD", "IFO", "NBC", "BC", "MFC", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))

bls_firm_cstd<-bls_firm_cstd%>%
  mutate(Factors=BLS_ITEM)%>%
  select(Date,Factors,value)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_firm_cstd,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_firm_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Spain, Credit Standards/Firms, breakdown factors, full time series")

```

### Ireland, full series (Q2 2024)
```{r}

# FIRM CREDIT STANDARDS - Italy
# Effect domain: Credit Standards (ST), BLS contract counterpart: enterprises (E); BLS counterpart motivation (LE):large enterprises
# Market role: loan supply (S)
# weighted net percentage (tightened minus eased or reverse), based on the share of each bank in the total loan outstanding amount of the banks in the BLS sample

series_key <- "Q.IE.ALL..E.Z..ST.S.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_cstd = date_convert(bls_firm_cstd)

bls_firm_cstd= bls_firm_cstd%>%
  filter(BLS_ITEM=="O")%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_firm_cstd,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Spain, Credit Standards/Firms, full time series")+
  theme_bw()

write.csv(bls_firm_cstd, "IE_CrS_Firms.csv")

```

### Ireland, breakdown (Q2 2024)

```{r}
# FIRM CREDIT STANDARDS - Ireland,IE
# Effect domain: Credit Standards (ST), BLS contract counterpart: enterprises (E); BLS counterpart motivation (LE):large enterprises
# Market role: loan supply (S)
# weighted net percentage (tightened minus eased or reverse), based on the share of each bank in the total loan outstanding amount of the banks in the BLS sample

series_key <- "Q.IE.ALL..E.Z..ST.S.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_cstd = date_convert(bls_firm_cstd)

bls_firm_cstd1= bls_firm_cstd%>%
  filter(BLS_ITEM=="O")%>%
  mutate(Date=date-months(3))%>%
  select(Date,TIME_HORIZON,OBS_VALUE)%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  filter(Date>="2020-01-01")

factors = c("BC", "CP", "GEA", "IFO", "LP", "MF", "MFC", "NBC", "RCD", "RTO")

bls_firm_cstd = bls_firm_cstd  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, CP, na.rm = T)/3, 
         "Risk perceptions" = sum(GEA, RCD, IFO, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, MFC, na.rm = T)/3, 
         "Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "RCD", "IFO", "NBC", "BC", "MFC", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))

bls_firm_cstd<-bls_firm_cstd%>%
  mutate(Factors=BLS_ITEM)%>%
  select(Date,Factors,value)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_firm_cstd,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_firm_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Ireland, Credit Standards/Firms, breakdown factors, full time series")

```

## SubSection 1.2 Credit standards - SME loans

### Euro Area, full series (Q2 2024)

```{r}

### LE Loans - CREDIT STANDARDS: Q..ALL.LE.E.Z..ST.S.
### Bank lending survey item: Large enterprises(LE); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.U2.ALL.SME.E.Z..ST.S.WFNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_sme_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_sme_cstd = date_convert(bls_sme_cstd)

bls_sme_cstd= bls_sme_cstd%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_sme_cstd,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Euro Area, Credit Standards/SME firms, full time series")+
  theme_bw()

write.csv(bls_sme_cstd, "EA_CrS_FirmsSME.csv")

```

### Euro Area, breakdown (Q2 2024) 

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.U2.ALL.SME.E.Z..ST.S.WFNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_sme_cstd1= df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_sme_cstd1= date_convert(bls_sme_cstd1)

bls_sme_cstd1= bls_sme_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)%>%
  filter(Date>="2020-01-01")

series_key<- "Q.U2.ALL..E.SME.B3.ST.S.WFNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_sme_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_sme_cstd = date_convert(bls_sme_cstd)

factors = c("BC", "CP", "GEA", "IFO", "LP", "MF", "MFC", "NBC", "RCD", "RTO")

bls_sme_cstd = bls_sme_cstd  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, CP, na.rm = T)/3, 
         "Risk perceptions" = sum(GEA, RCD, IFO, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, MFC, na.rm = T)/3, 
         "Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "RCD", "IFO", "NBC", "BC", "MFC", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))

bls_sme_cstd<-bls_sme_cstd%>%
  mutate(Factors=BLS_ITEM)%>%
  select(Date,Factors,value)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_sme_cstd,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_sme_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Euro Area, Credit Standards/SME Firms, breakdown factors, full time series")

write.csv(bls_sme_cstd, "EA_CrS_FirmsSME.csv")

```

### France, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.FR.ALL.SME.E.Z..ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_sme_cstd1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_sme_cstd1 = date_convert(bls_sme_cstd1)

bls_sme_cstd1= bls_sme_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_sme_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("France, Credit Standards/SME Firms, full time series")+
  theme_bw()

write.csv(bls_sme_cstd1, "FR_CrS_FirmsSME.csv")

```

### France,breakdown (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.FR.ALL..E.SME.B3.ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_sme_st = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_sme_st = date_convert(bls_sme_st)

factors = c("BC", "CP", "GEA", "IFO", "LP", "MF", "MFC", "NBC", "RCD", "RTO")

bls_sme_st = bls_sme_st  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, CP, na.rm = T)/3, 
         "Risk perceptions" = sum(GEA, RCD, IFO, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, MFC, na.rm = T)/3, 
         "Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "RCD", "IFO", "NBC", "BC", "MFC", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

bls_sme_cstd1<-bls_sme_cstd1%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_sme_st,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_sme_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("France, Credit Standards/SME Firms, breakdown factors, full time series")

write.csv(bls_sme_st, "FR_CrS_FirmsSME.csv")

```

### Germany, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.DE.ALL.SME.E.Z..ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_sme_cstd1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_sme_cstd1 = date_convert(bls_sme_cstd1)

bls_sme_cstd1= bls_sme_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_sme_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Germany, Credit Standards/SME Firms, full time series")+
  theme_bw()

write.csv(bls_sme_cstd1, "DE_CrS_FirmsSME.csv")
```

### Germany,breakdown (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.DE.ALL..E.SME.B3.ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_sme_st = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_sme_st = date_convert(bls_sme_st)

factors = c("BC", "CP", "GEA", "IFO", "LP", "MF", "MFC", "NBC", "RCD", "RTO")

bls_sme_st = bls_sme_st  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, CP, na.rm = T)/3, 
         "Risk perceptions" = sum(GEA, RCD, IFO, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, MFC, na.rm = T)/3, 
         "Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "RCD", "IFO", "NBC", "BC", "MFC", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

bls_sme_cstd1<-bls_sme_cstd1%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_sme_st,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_sme_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Germany, Credit Standards/SME Firms, breakdown factors, full time series")

write.csv(bls_sme_st, "DE_CrS_FirmsSME.csv")

```
### Italy, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.IT.ALL.SME.E.Z..ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_sme_cstd1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_sme_cstd1 = date_convert(bls_sme_cstd1)

bls_sme_cstd1= bls_sme_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_sme_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Italy, Credit Standards/SME Firms, full time series")+
  theme_bw()

write.csv(bls_sme_cstd1, "IT_CrS_FirmsSME.csv")
```

### Italy,breakdown (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.IT.ALL..E.SME.B3.ST.S.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_sme_st = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_sme_st = date_convert(bls_sme_st)

factors = c("BC", "CP", "GEA", "IFO", "LP", "MF", "MFC", "NBC", "RCD", "RTO")

bls_sme_st = bls_sme_st  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, CP, na.rm = T)/3, 
         "Risk perceptions" = sum(GEA, RCD, IFO, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, MFC, na.rm = T)/3, 
         "Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "RCD", "IFO", "NBC", "BC", "MFC", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

bls_sme_cstd1<-bls_sme_cstd1%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_sme_st,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_sme_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Italy, Credit Standards/SME Firms, breakdown factors, full time series")

write.csv(bls_sme_st, "IT_CrS_FirmsSME.csv")

```

### Spain, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.ES.ALL.SME.E.Z..ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_sme_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_sme_cstd = date_convert(bls_sme_cstd)

bls_sme_cstd= bls_sme_cstd%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_sme_cstd,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Spain, Credit Standards/SME Firms, full time series")+
  theme_bw()

write.csv(bls_sme_cstd, "ES_CrS_FirmsSME.csv")

```

### Spain,breakdown (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.ES.ALL..E.SME.B3.ST.S.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_sme_st = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_sme_st = date_convert(bls_sme_st)

factors = c("BC", "CP", "GEA", "IFO", "LP", "MF", "MFC", "NBC", "RCD", "RTO")

bls_sme_st = bls_sme_st  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, CP, na.rm = T)/3, 
         "Risk perceptions" = sum(GEA, RCD, IFO, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, MFC, na.rm = T)/3, 
         "Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "RCD", "IFO", "NBC", "BC", "MFC", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

bls_sme_cstd1<-bls_sme_cstd1%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_sme_st,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_sme_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Spain, Credit Standards/SME Firms, breakdown factors, full time series")

write.csv(bls_sme_st, "ES_CrS_FirmsSME.csv")

```

### Ireland, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.IE.ALL.SME.E.Z..ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_sme_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_sme_cstd = date_convert(bls_sme_cstd)

bls_sme_cstd= bls_sme_cstd%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_sme_cstd,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Ireland, Credit Standards/SME Firms, full time series")+
  theme_bw()

write.csv(bls_sme_cstd, "IE_CrS_FirmsSME.csv")

```

### Ireland,breakdown (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.IE.ALL..E.SME.B3.ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_sme_st = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_sme_st = date_convert(bls_sme_st)

factors = c("BC", "CP", "GEA", "IFO", "LP", "MF", "MFC", "NBC", "RCD", "RTO")

bls_sme_st = bls_sme_st  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, CP, na.rm = T)/3, 
         "Risk perceptions" = sum(GEA, RCD, IFO, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, MFC, na.rm = T)/3, 
         "Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "RCD", "IFO", "NBC", "BC", "MFC", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

bls_sme_cstd1<-bls_sme_cstd1%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_sme_st,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_sme_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Ireland, Credit Standards/SME Firms, breakdown factors, full time series")

write.csv(bls_sme_st, "IE_CrS_FirmsSME.csv")

```

## SubSection 1.3 Credit standards - LE loans (Q2 2024)

### Euro Area, full series (Q2 2024)

```{r}

### LE Loans - CREDIT STANDARDS: Q..ALL.LE.E.Z..ST.S.
### Bank lending survey item: Large enterprises(LE); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.U2.ALL.LE.E.Z..ST.S.WFNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_le_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_le_cstd = date_convert(bls_le_cstd)

bls_le_cstd= bls_le_cstd%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_le_cstd,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Euro Area, Credit Standards/Large firms, full time series")+
  theme_bw()

write.csv(bls_sme_cstd, "EA_CrS_FirmsLE.csv")

```

### Euro Area, breakdown (Q2 2024) 

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.U2.ALL.LE.E.Z..ST.S.WFNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_le_cstd1= df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_le_cstd1= date_convert(bls_le_cstd1)

bls_le_cstd1= bls_le_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)%>%
  filter(Date>="2020-01-01")

series_key<- "Q.U2.ALL..E.LE.B3.ST.S.WFNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_le_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_le_cstd = date_convert(bls_le_cstd)

factors = c("BC", "CP", "GEA", "IFO", "LP", "MF", "MFC", "NBC", "RCD", "RTO")

bls_le_cstd = bls_le_cstd  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, CP, na.rm = T)/3, 
         "Risk perceptions" = sum(GEA, RCD, IFO, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, MFC, na.rm = T)/3, 
         "Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "RCD", "IFO", "NBC", "BC", "MFC", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))

bls_le_cstd<-bls_le_cstd%>%
  mutate(Factors=BLS_ITEM)%>%
  select(Date,Factors,value)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_le_cstd,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_le_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Euro Area, Credit Standards/Large Firms, breakdown factors, full time series")

write.csv(bls_le_cstd, "EA_CrS_FirmsLEbreak.csv")

```

###France, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.FR.ALL.LE.E.Z..ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_le_cstd1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_le_cstd1 = date_convert(bls_le_cstd1)

bls_le_cstd1= bls_le_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_le_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("France, Credit Standards/Large Firms, full time series")+
  theme_bw()

write.csv(bls_le_cstd1, "FR_CrS_FirmsLE.csv")

```

###France,breakdown (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.FR.ALL..E.LE.B3.ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_le_st = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_le_st = date_convert(bls_le_st)

factors = c("BC", "CP", "GEA", "IFO", "LP", "MF", "MFC", "NBC", "RCD", "RTO")

bls_le_st = bls_le_st  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, CP, na.rm = T)/3, 
         "Risk perceptions" = sum(GEA, RCD, IFO, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, MFC, na.rm = T)/3, 
         "Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "RCD", "IFO", "NBC", "BC", "MFC", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

bls_le_cstd1<-bls_le_cstd1%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_le_st,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_le_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("France, Credit Standards/Large Firms, breakdown factors, full time series")

write.csv(bls_le_st, "FR_CrS_FirmsLEbreak.csv")

```

### Germany, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.DE.ALL.LE.E.Z..ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_le_cstd1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_le_cstd1 = date_convert(bls_le_cstd1)

bls_le_cstd1= bls_le_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_le_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Germany, Credit Standards/Large Firms, full time series")+
  theme_bw()

write.csv(bls_le_cstd1, "DE_CrS_FirmsLE.csv")

```

### Germany,breakdown (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.DE.ALL..E.LE.B3.ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_le_st = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_le_st = date_convert(bls_le_st)

factors = c("BC", "CP", "GEA", "IFO", "LP", "MF", "MFC", "NBC", "RCD", "RTO")

bls_le_st = bls_le_st  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, CP, na.rm = T)/3, 
         "Risk perceptions" = sum(GEA, RCD, IFO, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, MFC, na.rm = T)/3, 
         "Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "RCD", "IFO", "NBC", "BC", "MFC", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

bls_le_cstd1<-bls_le_cstd1%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_le_st,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_le_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Germany, Credit Standards/Large Firms, breakdown factors, full time series")

write.csv(bls_le_st, "DE_CrS_FirmsLEbreak.csv")

```

### Italy, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.IT.ALL.LE.E.Z..ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_le_cstd1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_le_cstd1 = date_convert(bls_le_cstd1)

bls_le_cstd1= bls_le_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_le_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Italy, Credit Standards/Large Firms, full time series")+
  theme_bw()

write.csv(bls_le_cstd1, "IT_CrS_FirmsLE.csv")

```

### Italy,breakdown (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.IT.ALL..E.LE.B3.ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_le_st = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_le_st = date_convert(bls_le_st)

factors = c("BC", "CP", "GEA", "IFO", "LP", "MF", "MFC", "NBC", "RCD", "RTO")

bls_le_st = bls_le_st  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, CP, na.rm = T)/3, 
         "Risk perceptions" = sum(GEA, RCD, IFO, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, MFC, na.rm = T)/3, 
         "Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "RCD", "IFO", "NBC", "BC", "MFC", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

bls_le_cstd1<-bls_le_cstd1%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_le_st,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_le_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Italy, Credit Standards/Large Firms, breakdown factors, full time series")

write.csv(bls_le_st, "IT_CrS_FirmsLEbreak.csv")

```

### Spain, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.ES.ALL.LE.E.Z..ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_le_cstd1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_le_cstd1 = date_convert(bls_le_cstd1)

bls_le_cstd1= bls_le_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_le_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Spain, Credit Standards/Large Firms, full time series")+
  theme_bw()

write.csv(bls_le_cstd1, "ES_CrS_FirmsLE.csv")

```

### Spain,breakdown (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.ES.ALL..E.LE.B3.ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_le_st = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_le_st = date_convert(bls_le_st)

factors = c("BC", "CP", "GEA", "IFO", "LP", "MF", "MFC", "NBC", "RCD", "RTO")

bls_le_st = bls_le_st  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, CP, na.rm = T)/3, 
         "Risk perceptions" = sum(GEA, RCD, IFO, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, MFC, na.rm = T)/3, 
         "Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "RCD", "IFO", "NBC", "BC", "MFC", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

bls_le_cstd1<-bls_le_cstd1%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_le_st,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_le_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Spain, Credit Standards/Large Firms, breakdown factors, full time series")

write.csv(bls_le_st, "ES_CrS_FirmsLEbreak.csv")

```

### Ireland, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.IE.ALL.LE.E.Z..ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_le_cstd1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_le_cstd1 = date_convert(bls_le_cstd1)

bls_le_cstd1= bls_le_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_le_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Ireland, Credit Standards/Large Firms, full time series")+
  theme_bw()

write.csv(bls_le_cstd1, "IE_CrS_FirmsLE.csv")

```

### Ireland,breakdown (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.IE.ALL..E.LE.B3.ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_le_st = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_le_st = date_convert(bls_le_st)

factors = c("BC", "CP", "GEA", "IFO", "LP", "MF", "MFC", "NBC", "RCD", "RTO")

bls_le_st = bls_le_st  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, CP, na.rm = T)/3, 
         "Risk perceptions" = sum(GEA, RCD, IFO, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, MFC, na.rm = T)/3, 
         "Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "RCD", "IFO", "NBC", "BC", "MFC", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

bls_le_cstd1<-bls_le_cstd1%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_le_st,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_le_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Ireland, Credit Standards/Large Firms, breakdown factors, full time series")

write.csv(bls_le_st, "IE_CrS_FirmsLEbreak.csv")

```

## Subsection 1.4 Demand

### Euro Area, full series (Q2 2024)

```{r}

series_key<- "Q.U2.ALL.O.E.Z..ZZ.D.WFNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand1 = date_convert(bls_firm_demand1)

bls_firm_demand1= bls_firm_demand1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_firm_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Euro Area, Firms/ Loan Demand, full time series")+
  theme_bw()

write.csv(bls_firm_demand1, "EA_Demand.csv")

```

### Euro Area, breakdown (Q2 2024)

```{r}

# DEMAND/ ENTERPRISES - EURO AREA, "U2"

bls_firm_demand1<-bls_firm_demand1%>%
    filter(Date>="2020-01-01")

series_key <- "Q.U2.ALL..E.Z..ZZ.D.WFNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand = date_convert(bls_firm_demand)

factors = c("O", "DR", "DSI", "EQI", "FIX", "GLI", "IF", "INV", "LNB", "LOB", "MAA")

bls_firm_demand = bls_firm_demand  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Other financing needs" = sum(DR,MAA, na.rm = T)/2, 
         "Use of alternative finance" = sum(IF, LOB, LNB, DSI, EQI, na.rm = T)/5, 
         "Fixed Investment" = (FIX),
         "Inventories and Working Capital"=(INV),
         "General level of interest rate"=(GLI)) %>%
  select(-c("DR", "DSI", "EQI", "FIX", "GLI", "IF", "INV", "LNB", "LOB", "MAA")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("O",  "TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_firm_demand,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_firm_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Euro Area, Firms/ Loan demand, breakdown factors, full time series")

write.csv(bls_firm_demand, "EA_Demand_Firms.csv")

```

### France, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.FR.ALL.O.E.Z..ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand1 = date_convert(bls_firm_demand1)

bls_firm_demand1= bls_firm_demand1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_firm_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("France, Firms/ Demand, full time series")+
  theme_bw()

write.csv(bls_firm_demand, "FR_Demand.csv")

```

### France, breakdown (Q2 2024)

```{r}

# DEMAND/ ENTERPRISES - EURO AREA, "U2"

bls_firm_demand1<-bls_firm_demand1%>%
    filter(Date>="2020-01-01")

series_key <- "Q.FR.ALL..E.Z..ZZ.D.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand = date_convert(bls_firm_demand)

factors = c("O", "DR", "DSI", "EQI", "FIX", "GLI", "IF", "INV", "LNB", "LOB", "MAA")

bls_firm_demand = bls_firm_demand  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Other financing needs" = sum(DR,MAA, na.rm = T)/2, 
         "Use of alternative finance" = sum(IF, LOB, LNB, DSI, EQI, na.rm = T)/5, 
         "Fixed Investment" = (FIX),
         "Inventories and Working Capital"=(INV),
         "General level of interest rate"=(GLI)) %>%
  select(-c("DR", "DSI", "EQI", "FIX", "GLI", "IF", "INV", "LNB", "LOB", "MAA")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("O",  "TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_firm_demand,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_firm_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("France, Firms/Demand, breakdown factors, full time series")

write.csv(bls_firm_demand, "FR_Demand_Firms.csv")

```

### Germany, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.DE.ALL.O.E.Z..ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand1 = date_convert(bls_firm_demand1)

bls_firm_demand1= bls_firm_demand1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_firm_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Germany, Firms/Demand, full time series")+
  theme_bw()

write.csv(bls_firm_demand, "DE_Demand.csv")

```

### Germany, breakdown (Q2 2024)

```{r}

# DEMAND/ ENTERPRISES - EURO AREA, "U2"

bls_firm_demand1<-bls_firm_demand1%>%
    filter(Date>="2020-01-01")

series_key <- "Q.DE.ALL..E.Z..ZZ.D.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand = date_convert(bls_firm_demand)

factors = c("O", "DR", "DSI", "EQI", "FIX", "GLI", "IF", "INV", "LNB", "LOB", "MAA")

bls_firm_demand = bls_firm_demand  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Other financing needs" = sum(DR,MAA, na.rm = T)/2, 
         "Use of alternative finance" = sum(IF, LOB, LNB, DSI, EQI, na.rm = T)/5, 
         "Fixed Investment" = (FIX),
         "Inventories and Working Capital"=(INV),
         "General level of interest rate"=(GLI)) %>%
  select(-c("DR", "DSI", "EQI", "FIX", "GLI", "IF", "INV", "LNB", "LOB", "MAA")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("O",  "TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_firm_demand,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_firm_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Germany, Firms/Demand, breakdown factors, full time series")

write.csv(bls_firm_demand, "DE_Demand_Firms.csv")

```

### Italy, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.IT.ALL.O.E.Z..ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand1 = date_convert(bls_firm_demand1)

bls_firm_demand1= bls_firm_demand1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_firm_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Italy, Firms/Demand, full time series")+
  theme_bw()

write.csv(bls_firm_demand, "IT_Demand.csv")

```

### Italy, breakdown (Q2 2024)

```{r}

# DEMAND/ ENTERPRISES - EURO AREA, "U2"

bls_firm_demand1<-bls_firm_demand1%>%
    filter(Date>="2020-01-01")

series_key <- "Q.IT.ALL..E.Z..ZZ.D.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand = date_convert(bls_firm_demand)

factors = c("O", "DR", "DSI", "EQI", "FIX", "GLI", "IF", "INV", "LNB", "LOB", "MAA")

bls_firm_demand = bls_firm_demand  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Other financing needs" = sum(DR,MAA, na.rm = T)/2, 
         "Use of alternative finance" = sum(IF, LOB, LNB, DSI, EQI, na.rm = T)/5, 
         "Fixed Investment" = (FIX),
         "Inventories and Working Capital"=(INV),
         "General level of interest rate"=(GLI)) %>%
  select(-c("DR", "DSI", "EQI", "FIX", "GLI", "IF", "INV", "LNB", "LOB", "MAA")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("O",  "TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_firm_demand,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_firm_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Italy, Firms/Demand, breakdown factors, full time series")

write.csv(bls_firm_demand, "IT_Demand_Firms.csv")

```

### Spain, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.ES.ALL.O.E.Z..ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand1 = date_convert(bls_firm_demand1)

bls_firm_demand1= bls_firm_demand1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_firm_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Spain, Firms/Demand, full time series")+
  theme_bw()

write.csv(bls_firm_demand, "ES_Demand.csv")

```

### Spain, breakdown (Q2 2024)

```{r}

# DEMAND/ ENTERPRISES - EURO AREA, "U2"

bls_firm_demand1<-bls_firm_demand1%>%
    filter(Date>="2020-01-01")

series_key <- "Q.ES.ALL..E.Z..ZZ.D.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand = date_convert(bls_firm_demand)

factors = c("O", "DR", "DSI", "EQI", "FIX", "GLI", "IF", "INV", "LNB", "LOB", "MAA")

bls_firm_demand = bls_firm_demand  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Other financing needs" = sum(DR,MAA, na.rm = T)/2, 
         "Use of alternative finance" = sum(IF, LOB, LNB, DSI, EQI, na.rm = T)/5, 
         "Fixed Investment" = (FIX),
         "Inventories and Working Capital"=(INV),
         "General level of interest rate"=(GLI)) %>%
  select(-c("DR", "DSI", "EQI", "FIX", "GLI", "IF", "INV", "LNB", "LOB", "MAA")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("O",  "TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_firm_demand,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_firm_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Spain, Firms/Demand, breakdown factors, full time series")

write.csv(bls_firm_demand, "ES_Demand_Firms.csv")

```

### Ireland, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.IE.ALL.O.E.Z..ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand1 = date_convert(bls_firm_demand1)

bls_firm_demand1= bls_firm_demand1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_firm_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Ireland, Firms/Demand, full time series")+
  theme_bw()

write.csv(bls_firm_demand, "IE_Demand.csv")

```

### Ireland, breakdown (Q2 2024)

```{r}

# DEMAND/ ENTERPRISES - EURO AREA, "U2"

bls_firm_demand1<-bls_firm_demand1%>%
    filter(Date>="2020-01-01")

series_key <- "Q.IE.ALL..E.Z..ZZ.D.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand = date_convert(bls_firm_demand)

factors = c("O", "DR", "DSI", "EQI", "FIX", "GLI", "IF", "INV", "LNB", "LOB", "MAA")

bls_firm_demand = bls_firm_demand  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Other financing needs" = sum(DR,MAA, na.rm = T)/2, 
         "Use of alternative finance" = sum(IF, LOB, LNB, DSI, EQI, na.rm = T)/5, 
         "Fixed Investment" = (FIX),
         "Inventories and Working Capital"=(INV),
         "General level of interest rate"=(GLI)) %>%
  select(-c("DR", "DSI", "EQI", "FIX", "GLI", "IF", "INV", "LNB", "LOB", "MAA")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("O",  "TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_firm_demand,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_firm_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Ireland, Firms/Demand, breakdown factors, full time series")

write.csv(bls_firm_demand, "IE_Demand_Firms.csv")

```

## Subsection 1.5 Demand/ Type of loans, backward looking 

### Euro area, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.U2.ALL.LE+LTL+SME+STL.E.Z.B3.ZZ.D.WFNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand = date_convert(bls_firm_demand)

bls_firm_demand= bls_firm_demand%>%
  mutate(Date=date-months(3))%>%
  mutate(TypeLoan=case_when(
    BLS_ITEM=="LE"~"Large Firms",
    BLS_ITEM=="SME"~"SME",
    BLS_ITEM=="LTL"~"Long term loans",
    BLS_ITEM=="STL"~"Short term loans"))%>%
  select(Date,TypeLoan,OBS_VALUE)

ggplot(data=bls_firm_demand,aes(x=Date,y=OBS_VALUE,group=TypeLoan))+
  geom_line(aes(color=TypeLoan))+
  scale_color_manual(values=c("red","black","green","purple"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Euro Area, Firms/ Demand -Type of Loans,Backward looking, full time series")+
  theme_bw()

write.csv(bls_firm_demand, "EA_Demand_typeofloans_B3.csv")

```

### France, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.FR.ALL.LE+LTL+SME+STL.E.Z.B3.ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand = date_convert(bls_firm_demand)

bls_firm_demand= bls_firm_demand%>%
  mutate(Date=date-months(3))%>%
  mutate(TypeLoan=case_when(
    BLS_ITEM=="LE"~"Large Firms",
    BLS_ITEM=="SME"~"SME",
    BLS_ITEM=="LTL"~"Long term loans",
    BLS_ITEM=="STL"~"Short term loans"))%>%
  select(Date,TypeLoan,OBS_VALUE)

ggplot(data=bls_firm_demand,aes(x=Date,y=OBS_VALUE,group=TypeLoan))+
  geom_line(aes(color=TypeLoan))+
  scale_color_manual(values=c("red","black","green","purple"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("France, Firms/ Demand - Type of Loans,Backward looking, full time series")+
  theme_bw()

write.csv(bls_firm_demand, "FR_Demand_typeofloans_B3.csv")

```

### Germany, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.DE.ALL.LE+LTL+SME+STL.E.Z.B3.ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand = date_convert(bls_firm_demand)

bls_firm_demand= bls_firm_demand%>%
  mutate(Date=date-months(3))%>%
  mutate(TypeLoan=case_when(
    BLS_ITEM=="LE"~"Large Firms",
    BLS_ITEM=="SME"~"SME",
    BLS_ITEM=="LTL"~"Long term loans",
    BLS_ITEM=="STL"~"Short term loans"))%>%
  select(Date,TypeLoan,OBS_VALUE)

ggplot(data=bls_firm_demand,aes(x=Date,y=OBS_VALUE,group=TypeLoan))+
  geom_line(aes(color=TypeLoan))+
  scale_color_manual(values=c("red","black","green","purple"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Germany, Firms/ Demand - Type of Loans,Backward looking, full time series")+
  theme_bw()

write.csv(bls_firm_demand, "DE_Demand_typeofloans_B3.csv")

```

### Italy, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.IT.ALL.LE+LTL+SME+STL.E.Z.B3.ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand = date_convert(bls_firm_demand)

bls_firm_demand= bls_firm_demand%>%
  mutate(Date=date-months(3))%>%
  mutate(TypeLoan=case_when(
    BLS_ITEM=="LE"~"Large Firms",
    BLS_ITEM=="SME"~"SME",
    BLS_ITEM=="LTL"~"Long term loans",
    BLS_ITEM=="STL"~"Short term loans"))%>%
  select(Date,TypeLoan,OBS_VALUE)

ggplot(data=bls_firm_demand,aes(x=Date,y=OBS_VALUE,group=TypeLoan))+
  geom_line(aes(color=TypeLoan))+
  scale_color_manual(values=c("red","black","green","purple"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Italy, Firms/ Demand - Type of Loans,Backward looking, full time series")+
  theme_bw()

write.csv(bls_firm_demand, "IT_Demand_typeofloans_B3.csv")

```

### Spain, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.ES.ALL.LE+LTL+SME+STL.E.Z.B3.ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand = date_convert(bls_firm_demand)

bls_firm_demand= bls_firm_demand%>%
  mutate(Date=date-months(3))%>%
  mutate(TypeLoan=case_when(
    BLS_ITEM=="LE"~"Large Firms",
    BLS_ITEM=="SME"~"SME",
    BLS_ITEM=="LTL"~"Long term loans",
    BLS_ITEM=="STL"~"Short term loans"))%>%
  select(Date,TypeLoan,OBS_VALUE)

ggplot(data=bls_firm_demand,aes(x=Date,y=OBS_VALUE,group=TypeLoan))+
  geom_line(aes(color=TypeLoan))+
  scale_color_manual(values=c("red","black","green","purple"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Spain, Firms/ Demand - Type of Loans,Backward looking, full time series")+
  theme_bw()

write.csv(bls_firm_demand, "ES_Demand_typeofloans_B3.csv")

```

### Ireland, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.IE.ALL.LE+LTL+SME+STL.E.Z.B3.ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand = date_convert(bls_firm_demand)

bls_firm_demand= bls_firm_demand%>%
  mutate(Date=date-months(3))%>%
  mutate(TypeLoan=case_when(
    BLS_ITEM=="LE"~"Large Firms",
    BLS_ITEM=="SME"~"SME",
    BLS_ITEM=="LTL"~"Long term loans",
    BLS_ITEM=="STL"~"Short term loans"))%>%
  select(Date,TypeLoan,OBS_VALUE)

ggplot(data=bls_firm_demand,aes(x=Date,y=OBS_VALUE,group=TypeLoan))+
  geom_line(aes(color=TypeLoan))+
  scale_color_manual(values=c("red","black","green","purple"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Ireland, Firms/ Demand - Type of Loans,Backward looking, full time series")+
  theme_bw()

write.csv(bls_firm_demand, "IE_Demand_typeofloans_B3.csv")

```


## Subsection 1.6 Demand/ Type of loans, forward looking 

### Euro area, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.U2.ALL.LE+LTL+SME+STL.E.Z.F3.ZZ.D.WFNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand = date_convert(bls_firm_demand)

bls_firm_demand= bls_firm_demand%>%
  mutate(Date=date-months(3))%>%
  mutate(TypeLoan=case_when(
    BLS_ITEM=="LE"~"Large Firms",
    BLS_ITEM=="SME"~"SME",
    BLS_ITEM=="LTL"~"Long term loans",
    BLS_ITEM=="STL"~"Short term loans"))%>%
  select(Date,TypeLoan,OBS_VALUE)

ggplot(data=bls_firm_demand,aes(x=Date,y=OBS_VALUE,group=TypeLoan))+
  geom_line(aes(color=TypeLoan))+
  scale_color_manual(values=c("red","black","green","purple"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Euro Area, Firms/ Demand - Type of Loans,Forward looking, full time series")+
  theme_bw()

write.csv(bls_firm_demand, "EA_Demand_typeofloans_F3.csv")

```

### France, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.FR.ALL.LE+LTL+SME+STL.E.Z.F3.ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand = date_convert(bls_firm_demand)

bls_firm_demand= bls_firm_demand%>%
  mutate(Date=date-months(3))%>%
  mutate(TypeLoan=case_when(
    BLS_ITEM=="LE"~"Large Firms",
    BLS_ITEM=="SME"~"SME",
    BLS_ITEM=="LTL"~"Long term loans",
    BLS_ITEM=="STL"~"Short term loans"))%>%
  select(Date,TypeLoan,OBS_VALUE)

ggplot(data=bls_firm_demand,aes(x=Date,y=OBS_VALUE,group=TypeLoan))+
  geom_line(aes(color=TypeLoan))+
  scale_color_manual(values=c("red","black","green","purple"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("France, Firms/ Demand - Type of Loans,Forward looking, full time series")+
  theme_bw()

write.csv(bls_firm_demand, "FR_Demand_typeofloans_FR.csv")

```

### Germany, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.DE.ALL.LE+LTL+SME+STL.E.Z.F3.ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand = date_convert(bls_firm_demand)

bls_firm_demand= bls_firm_demand%>%
  mutate(Date=date-months(3))%>%
  mutate(TypeLoan=case_when(
    BLS_ITEM=="LE"~"Large Firms",
    BLS_ITEM=="SME"~"SME",
    BLS_ITEM=="LTL"~"Long term loans",
    BLS_ITEM=="STL"~"Short term loans"))%>%
  select(Date,TypeLoan,OBS_VALUE)

ggplot(data=bls_firm_demand,aes(x=Date,y=OBS_VALUE,group=TypeLoan))+
  geom_line(aes(color=TypeLoan))+
  scale_color_manual(values=c("red","black","green","purple"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Germany, Firms/ Demand - Type of Loans,Forward looking, full time series")+
  theme_bw()

write.csv(bls_firm_demand, "DE_Demand_typeofloans_F3.csv")

```

### Italy, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.IT.ALL.LE+LTL+SME+STL.E.Z.F3.ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand = date_convert(bls_firm_demand)

bls_firm_demand= bls_firm_demand%>%
  mutate(Date=date-months(3))%>%
  mutate(TypeLoan=case_when(
    BLS_ITEM=="LE"~"Large Firms",
    BLS_ITEM=="SME"~"SME",
    BLS_ITEM=="LTL"~"Long term loans",
    BLS_ITEM=="STL"~"Short term loans"))%>%
  select(Date,TypeLoan,OBS_VALUE)

ggplot(data=bls_firm_demand,aes(x=Date,y=OBS_VALUE,group=TypeLoan))+
  geom_line(aes(color=TypeLoan))+
  scale_color_manual(values=c("red","black","green","purple"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Italy, Firms/ Demand - Type of Loans,Forward looking, full time series")+
  theme_bw()

write.csv(bls_firm_demand, "IT_Demand_typeofloans_F3.csv")

```
### Spain, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.ES.ALL.LE+LTL+SME+STL.E.Z.F3.ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand = date_convert(bls_firm_demand)

bls_firm_demand= bls_firm_demand%>%
  mutate(Date=date-months(3))%>%
  mutate(TypeLoan=case_when(
    BLS_ITEM=="LE"~"Large Firms",
    BLS_ITEM=="SME"~"SME",
    BLS_ITEM=="LTL"~"Long term loans",
    BLS_ITEM=="STL"~"Short term loans"))%>%
  select(Date,TypeLoan,OBS_VALUE)

ggplot(data=bls_firm_demand,aes(x=Date,y=OBS_VALUE,group=TypeLoan))+
  geom_line(aes(color=TypeLoan))+
  scale_color_manual(values=c("red","black","green","purple"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Spain,Firms/ Demand - Type of Loans,Forward looking, full time series")+
  theme_bw()

write.csv(bls_firm_demand, "ES_Demand_typeofloans_F3.csv")

```

### Ireland, full series (Q2 2024)

```{r}

### SME Loans - CREDIT STANDARDS: Q..ALL.SME.E.Z..ST.S.
### Bank lending survey item: Small and medium enterprises (SME); effect domain: Credit Standards (ST); market role: supply (S)

series_key<- "Q.IE.ALL.LE+LTL+SME+STL.E.Z.F3.ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_firm_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_firm_demand = date_convert(bls_firm_demand)

bls_firm_demand= bls_firm_demand%>%
  mutate(Date=date-months(3))%>%
  mutate(TypeLoan=case_when(
    BLS_ITEM=="LE"~"Large Firms",
    BLS_ITEM=="SME"~"SME",
    BLS_ITEM=="LTL"~"Long term loans",
    BLS_ITEM=="STL"~"Short term loans"))%>%
  select(Date,TypeLoan,OBS_VALUE)

ggplot(data=bls_firm_demand,aes(x=Date,y=OBS_VALUE,group=TypeLoan))+
  geom_line(aes(color=TypeLoan))+
  scale_color_manual(values=c("red","black","green","purple"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Ireland, Firms/ Demand - Type of Loans,Forward looking, full time series")+
  theme_bw()

write.csv(bls_firm_demand, "IE_Demand_typeofloans_F3.csv")

```

# BLS - Households 
## Subsection 2.1 Credit Standards 

### Euro area, full series (Q2 2024)

```{r}

series_key <- "Q.U2.ALL.Z.H.H..ST.S.WFNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_cstd1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_cstd1 = date_convert(bls_hh_cstd1)

bls_hh_cstd1= bls_hh_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_hh_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Euro Area, Households/ Credit standards, full time series")+
  theme_bw()

write.csv(bls_hh_cstd1, "EA_HH_CrSt.csv")

```

### Euro Area, breakdown (Q2 2024)

```{r}

# HOUSEHOLD CREDIT STANDARDS
# Euro Area, U2 

bls_hh_cstd1<- bls_hh_cstd1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.U2.ALL..H.H..ST.S.WFNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_cstd = date_convert(bls_hh_cstd)

factors = c("Z", "BC", "BSC", "CP", "GEA", "CWB", "LP", "MF", "HMP", "NBC", "RTO")

bls_hh_cstd = bls_hh_cstd  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, BSC, CP, na.rm = T)/4, 
         "Risk perceptions" = sum(GEA, HMP, CWB, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, na.rm = T )/2, 
         "Banks' Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "BSC", "HMP", "NBC", "BC", "CWB", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z",  "TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_hh_cstd,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_hh_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Euro Area, Households Credit standards, breakdown factors, full time series")

```

### France, full series (Q2 2024)

```{r}

series_key <- "Q.FR.ALL.Z.H.H..ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_cstd1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_cstd1 = date_convert(bls_hh_cstd1)

bls_hh_cstd1= bls_hh_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_hh_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("France, Households/ Credit standards, full time series")+
  theme_bw()

write.csv(bls_hh_cstd1, "FR_HH_CrSt.csv")

```

### France, breakdown(Q2 2024)

```{r}
# HOUSEHOLD CREDIT STANDARDS
# France 

bls_hh_cstd1<- bls_hh_cstd1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.FR.ALL..H.H..ST.S.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_cstd = date_convert(bls_hh_cstd)

factors = c("Z", "BC", "BSC", "CP", "GEA", "CWB", "LP", "MF", "HMP", "NBC", "RTO")

bls_hh_cstd = bls_hh_cstd  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, BSC, CP, na.rm = T)/4, 
         "Risk perceptions" = sum(GEA, HMP, CWB, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, na.rm = T )/2, 
         "Banks' Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "BSC", "HMP", "NBC", "BC", "CWB", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z",  "TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_hh_cstd,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_hh_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("France, Households Credit standards, breakdown factors, full time series")

```

### Germany, full series (Q2 2024)

```{r}

series_key <- "Q.DE.ALL.Z.H.H..ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_cstd1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_cstd1 = date_convert(bls_hh_cstd1)

bls_hh_cstd1= bls_hh_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_hh_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Germany, Households/ Credit standards, full time series")+
  theme_bw()

write.csv(bls_hh_cstd1, "DE_HH_CrSt.csv")

```

### Germany, breakdown (Q2 2024)

```{r}
# HOUSEHOLD CREDIT STANDARDS
# Germany

bls_hh_cstd1<- bls_hh_cstd1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.DE.ALL..H.H..ST.S.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_cstd = date_convert(bls_hh_cstd)

factors = c("Z", "BC", "BSC", "CP", "GEA", "CWB", "LP", "MF", "HMP", "NBC", "RTO")

bls_hh_cstd = bls_hh_cstd  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, BSC, CP, na.rm = T)/4, 
         "Risk perceptions" = sum(GEA, HMP, CWB, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, na.rm = T )/2, 
         "Banks' Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "BSC", "HMP", "NBC", "BC", "CWB", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z",  "TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_hh_cstd,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_hh_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Germany, Households Credit standards, breakdown factors, full time series")

```

### Spain, full series (Q2 2024)

```{r}

series_key <- "Q.ES.ALL.Z.H.H..ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_cstd1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_cstd1 = date_convert(bls_hh_cstd1)

bls_hh_cstd1= bls_hh_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_hh_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Spain, Households/ Credit standards, full time series")+
  theme_bw()

write.csv(bls_hh_cstd1, "ES_HH_CrSt.csv")

```

### Spain, breakdown (Q2 2024)

```{r}
# HOUSEHOLD CREDIT STANDARDS
# Spain

bls_hh_cstd1<- bls_hh_cstd1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.ES.ALL..H.H..ST.S.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_cstd = date_convert(bls_hh_cstd)

factors = c("Z", "BC", "BSC", "CP", "GEA", "CWB", "LP", "MF", "HMP", "NBC", "RTO")

bls_hh_cstd = bls_hh_cstd  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, BSC, CP, na.rm = T)/4, 
         "Risk perceptions" = sum(GEA, HMP, CWB, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, na.rm = T )/2, 
         "Banks' Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "BSC", "HMP", "NBC", "BC", "CWB", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z",  "TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_hh_cstd,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_hh_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Spain, Households Credit standards, breakdown factors, full time series")

```

### Italy, full series (Q2 2024)

```{r}

series_key <- "Q.IT.ALL.Z.H.H..ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_cstd1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_cstd1 = date_convert(bls_hh_cstd1)

bls_hh_cstd1= bls_hh_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_hh_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Italy, Households/ Credit standards, full time series")+
  theme_bw()

write.csv(bls_hh_cstd1, "IT_HH_CrSt.csv")

```

### Italy, breakdown (Q2 2024)

```{r}
# HOUSEHOLD CREDIT STANDARDS
# Spain

bls_hh_cstd1<- bls_hh_cstd1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.IT.ALL..H.H..ST.S.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_cstd = date_convert(bls_hh_cstd)

factors = c("Z", "BC", "BSC", "CP", "GEA", "CWB", "LP", "MF", "HMP", "NBC", "RTO")

bls_hh_cstd = bls_hh_cstd  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, BSC, CP, na.rm = T)/4, 
         "Risk perceptions" = sum(GEA, HMP, CWB, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, na.rm = T )/2, 
         "Banks' Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "BSC", "HMP", "NBC", "BC", "CWB", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z",  "TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_hh_cstd,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_hh_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Italy, Households Credit standards, breakdown factors, full time series")

```

### Ireland, full series (Q2 2024)

```{r}

series_key <- "Q.IE.ALL.Z.H.H..ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_cstd1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_cstd1 = date_convert(bls_hh_cstd1)

bls_hh_cstd1= bls_hh_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_hh_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Ireland, Households/ Credit standards, full time series")+
  theme_bw()

write.csv(bls_hh_cstd1, "IE_HH_CrSt.csv")

```

### Ireland, breakdown (Q2 2024)

```{r}
# HOUSEHOLD CREDIT STANDARDS
# Spain

bls_hh_cstd1<- bls_hh_cstd1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.IE.ALL..H.H..ST.S.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_cstd = date_convert(bls_hh_cstd)

factors = c("Z", "BC", "BSC", "CP", "GEA", "CWB", "LP", "MF", "HMP", "NBC", "RTO")

bls_hh_cstd = bls_hh_cstd  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, BSC, CP, na.rm = T)/4, 
         "Risk perceptions" = sum(GEA, HMP, CWB, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, na.rm = T )/2, 
         "Banks' Risk tolerance" = (RTO)) %>%
  select(-c("LP", "MF", "CP", "GEA", "BSC", "HMP", "NBC", "BC", "CWB", "RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z",  "TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_hh_cstd,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_hh_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Ireland, Households Credit standards, breakdown factors, full time series")

```


## Subsection 2.2 Demand for Mortgages 

### Euro area, full series (Q2 2024)

```{r}

series_key <- "Q.U2.ALL.Z.H.H..ZZ.D.WFNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_demand1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_demand1 = date_convert(bls_hh_demand1)

bls_hh_demand1= bls_hh_demand1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_hh_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Euro Area, Households/ Demand for mortgage, full time series")+
  theme_bw()

write.csv(bls_hh_demand1, "EA_HH_Demand.csv")

```

### Euro area, breakdown (Q2 2024)

```{r}

# Demand / House purchase: contributing factors to change in demand 
# Euro area

bls_hh_demand1<- bls_hh_demand1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.U2.ALL..H.H..ZZ.D.WFNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_demand = date_convert(bls_hh_demand)

factors = c("Z","DR","RFR","IFS","LOB","OSF","GLI","HMP","CCF")

bls_hh_demand = bls_hh_demand  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Other financing needs" = sum(DR,RFR, na.rm = T)/2, 
         "Use of alternative finance" = sum(IFS, LOB, OSF, na.rm = T)/3, 
         "General Level of Interest Rate" = (GLI), 
         "Housing Market Prospects" = (HMP),
         "Consumer Confidence"=(CCF)) %>%
  select(-c("DR","RFR","IFS","LOB","OSF","GLI","HMP","CCF")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z","TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_hh_demand,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_hh_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Euro Area, Households Credit standards, breakdown factors, full time series")

```

### France, full series (Q2 2024)

```{r}

series_key <- "Q.FR.ALL.Z.H.H..ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_demand1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_demand1 = date_convert(bls_hh_demand1)

bls_hh_demand1= bls_hh_demand1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_hh_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("France, Households/ Demand for mortgage, full time series")+
  theme_bw()

write.csv(bls_hh_demand1, "EA_FR_Demand.csv")

```

### France, breakdown (Q2 2024)

```{r}

# Demand / House purchase: contributing factors to change in demand 
# Euro area

bls_hh_demand1<- bls_hh_demand1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.FR.ALL..H.H..ZZ.D.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_demand = date_convert(bls_hh_demand)

factors = c("Z","DR","RFR","IFS","LOB","OSF","GLI","HMP","CCF")

bls_hh_demand = bls_hh_demand  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Other financing needs" = sum(DR,RFR, na.rm = T)/2, 
         "Use of alternative finance" = sum(IFS, LOB, OSF, na.rm = T)/3, 
         "General Level of Interest Rate" = (GLI), 
         "Housing Market Prospects" = (HMP),
         "Consumer Confidence"=(CCF)) %>%
  select(-c("DR","RFR","IFS","LOB","OSF","GLI","HMP","CCF")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z","TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_hh_demand,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_hh_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("France, Households Credit standards, breakdown factors, full time series")

```

### Germany, full series (Q2 2024)

```{r}

series_key <- "Q.DE.ALL.Z.H.H..ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_demand1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_demand1 = date_convert(bls_hh_demand1)

bls_hh_demand1= bls_hh_demand1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_hh_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Germany, Households/ Demand for mortgage, full time series")+
  theme_bw()

write.csv(bls_hh_demand1, "DE_HH_Demand.csv")

```

### Germany, breakdown (Q2 2024)

```{r}

# Demand / House purchase: contributing factors to change in demand 
# Euro area

bls_hh_demand1<- bls_hh_demand1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.DE.ALL..H.H..ZZ.D.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_demand = date_convert(bls_hh_demand)

factors = c("Z","DR","RFR","IFS","LOB","OSF","GLI","HMP","CCF")

bls_hh_demand = bls_hh_demand  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Other financing needs" = sum(DR,RFR, na.rm = T)/2, 
         "Use of alternative finance" = sum(IFS, LOB, OSF, na.rm = T)/3, 
         "General Level of Interest Rate" = (GLI), 
         "Housing Market Prospects" = (HMP),
         "Consumer Confidence"=(CCF)) %>%
  select(-c("DR","RFR","IFS","LOB","OSF","GLI","HMP","CCF")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z","TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_hh_demand,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_hh_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Germany, Households Credit standards, breakdown factors, full time series")

```


### Spain, full series (Q2 2024)

```{r}

series_key <- "Q.ES.ALL.Z.H.H..ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_demand1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_demand1 = date_convert(bls_hh_demand1)

bls_hh_demand1= bls_hh_demand1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_hh_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Spain, Households/ Demand for mortgage, full time series")+
  theme_bw()

write.csv(bls_hh_demand1, "ES_HH_Demand.csv")

```

### Spain, breakdown (Q2 2024)

```{r}

# Demand / House purchase: contributing factors to change in demand 
# Euro area

bls_hh_demand1<- bls_hh_demand1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.ES.ALL..H.H..ZZ.D.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_demand = date_convert(bls_hh_demand)

factors = c("Z","DR","RFR","IFS","LOB","OSF","GLI","HMP","CCF")

bls_hh_demand = bls_hh_demand  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Other financing needs" = sum(DR,RFR, na.rm = T)/2, 
         "Use of alternative finance" = sum(IFS, LOB, OSF, na.rm = T)/3, 
         "General Level of Interest Rate" = (GLI), 
         "Housing Market Prospects" = (HMP),
         "Consumer Confidence"=(CCF)) %>%
  select(-c("DR","RFR","IFS","LOB","OSF","GLI","HMP","CCF")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z","TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_hh_demand,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_hh_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Spain, Households Credit standards, breakdown factors, full time series")

```


### Italy, full series (Q2 2024)

```{r}

series_key <- "Q.IT.ALL.Z.H.H..ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_demand1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_demand1 = date_convert(bls_hh_demand1)

bls_hh_demand1= bls_hh_demand1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_hh_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Italy, Households/ Demand for mortgage, full time series")+
  theme_bw()

write.csv(bls_hh_demand1, "IT_HH_Demand.csv")

```

### Italy, breakdown (Q2 2024)

```{r}

# Demand / House purchase: contributing factors to change in demand 
# Euro area

bls_hh_demand1<- bls_hh_demand1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.IT.ALL..H.H..ZZ.D.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_demand = date_convert(bls_hh_demand)

factors = c("Z","DR","RFR","IFS","LOB","OSF","GLI","HMP","CCF")

bls_hh_demand = bls_hh_demand  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Other financing needs" = sum(DR,RFR, na.rm = T)/2, 
         "Use of alternative finance" = sum(IFS, LOB, OSF, na.rm = T)/3, 
         "General Level of Interest Rate" = (GLI), 
         "Housing Market Prospects" = (HMP),
         "Consumer Confidence"=(CCF)) %>%
  select(-c("DR","RFR","IFS","LOB","OSF","GLI","HMP","CCF")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z","TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_hh_demand,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_hh_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Italy, Households Credit standards, breakdown factors, full time series")

```

### Ireland, full series (Q2 2024)

```{r}

series_key <- "Q.IE.ALL.Z.H.H..ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_demand1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_demand1 = date_convert(bls_hh_demand1)

bls_hh_demand1= bls_hh_demand1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_hh_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Ireland, Households/ Demand for mortgage, full time series")+
  theme_bw()

write.csv(bls_hh_demand1, "IE_HH_Demand.csv")

```

### Ireland, breakdown (Q2 2024)

```{r}

# Demand / House purchase: contributing factors to change in demand 
# Euro area

bls_hh_demand1<- bls_hh_demand1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.IE.ALL..H.H..ZZ.D.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_hh_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_hh_demand = date_convert(bls_hh_demand)

factors = c("Z","DR","RFR","IFS","LOB","OSF","GLI","HMP","CCF")

bls_hh_demand = bls_hh_demand  %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Other financing needs" = sum(DR,RFR, na.rm = T)/2, 
         "Use of alternative finance" = sum(IFS, LOB, OSF, na.rm = T)/3, 
         "General Level of Interest Rate" = (GLI), 
         "Housing Market Prospects" = (HMP),
         "Consumer Confidence"=(CCF)) %>%
  select(-c("DR","RFR","IFS","LOB","OSF","GLI","HMP","CCF")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z","TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_hh_demand,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_hh_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Ireland, Households Credit standards, breakdown factors, full time series")

```

# BLS - Consumer 

## Section 3.1 Credit Standards 

### Euro Area, full series (Q2 2024)

```{r}

series_key <- "Q.U2.ALL.Z.H.C..ST.S.WFNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_cstd1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_cstd1 = date_convert(bls_consumer_cstd1)

bls_consumer_cstd1= bls_consumer_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_consumer_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Euro Area, Consumer/ Credit standards, full time series")+
  theme_bw()

write.csv(bls_consumer_cstd1, "EA_Cons_Crst.csv")

```

### Euro area, breakdown (Q2 2024)

```{r}

# CONSUMER CREDIT STANDARDS
# Euro Area, U2 

bls_consumer_cstd1<- bls_consumer_cstd1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.U2.ALL..H.C..ST.S.WFNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_cstd = date_convert(bls_consumer_cstd )

factors = c("Z","LP","MF","BSC","CP","GEA","RCD","CWC","NBC","BC","RTO")

bls_consumer_cstd = bls_consumer_cstd %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, BSC, CP, na.rm = T)/4, 
         "Risk perceptions" = sum(GEA, RCD, CWC, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, na.rm = T )/2, 
         "Banks' Risk tolerance" = (RTO)) %>%
  select(-c("LP","MF","BSC","CP","GEA","RCD","CWC","NBC","BC","RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z",  "TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_consumer_cstd,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_consumer_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Euro Area, Consumer Credit Standards, breakdown factors, full time series")

```


### Euro Area, full series (Q2 2024)

```{r}

series_key <- "Q.U2.ALL.Z.H.C..ST.S.WFNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_cstd1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_cstd1 = date_convert(bls_consumer_cstd1)

bls_consumer_cstd1= bls_consumer_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_consumer_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Euro Area, Consumer/ Credit standards, full time series")+
  theme_bw()

write.csv(bls_consumer_cstd1, "EA_Cons_Crst.csv")

```

### Euro area, breakdown (Q2 2024)

```{r}

# CONSUMER CREDIT STANDARDS
# Euro Area, U2 

bls_consumer_cstd1<- bls_consumer_cstd1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.U2.ALL..H.C..ST.S.WFNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_cstd = date_convert(bls_consumer_cstd )

factors = c("Z","LP","MF","BSC","CP","GEA","RCD","CWC","NBC","BC","RTO")

bls_consumer_cstd = bls_consumer_cstd %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, BSC, CP, na.rm = T)/4, 
         "Risk perceptions" = sum(GEA, RCD, CWC, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, na.rm = T )/2, 
         "Banks' Risk tolerance" = (RTO)) %>%
  select(-c("LP","MF","BSC","CP","GEA","RCD","CWC","NBC","BC","RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z",  "TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_consumer_cstd,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_consumer_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Euro Area, Consumer Credit Standards, breakdown factors, full time series")

```

### France, full series (Q2 2024)

```{r}

series_key <- "Q.FR.ALL.Z.H.C..ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_cstd1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_cstd1 = date_convert(bls_consumer_cstd1)

bls_consumer_cstd1= bls_consumer_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_consumer_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("France, Consumer/ Credit standards, full time series")+
  theme_bw()

write.csv(bls_consumer_cstd1, "FR_Cons_Crst.csv")

```

### France, breakdown (Q2 2024)

```{r}

# CONSUMER CREDIT STANDARDS
# Euro Area, U2 

bls_consumer_cstd1<- bls_consumer_cstd1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.FR.ALL..H.C..ST.S.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_cstd = date_convert(bls_consumer_cstd )

factors = c("Z","LP","MF","BSC","CP","GEA","RCD","CWC","NBC","BC","RTO")

bls_consumer_cstd = bls_consumer_cstd %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, BSC, CP, na.rm = T)/4, 
         "Risk perceptions" = sum(GEA, RCD, CWC, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, na.rm = T )/2, 
         "Banks' Risk tolerance" = (RTO)) %>%
  select(-c("LP","MF","BSC","CP","GEA","RCD","CWC","NBC","BC","RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z",  "TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_consumer_cstd,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_consumer_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("France, Consumer Credit Standards, breakdown factors, full time series")

```

### Germany, full series (Q2 2024)

```{r}

series_key <- "Q.DE.ALL.Z.H.C..ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_cstd1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_cstd1 = date_convert(bls_consumer_cstd1)

bls_consumer_cstd1= bls_consumer_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_consumer_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Germany, Consumer/ Credit standards, full time series")+
  theme_bw()

write.csv(bls_consumer_cstd1, "DE_Cons_Crst.csv")

```

### Germany, breakdown (Q2 2024)

```{r}

# CONSUMER CREDIT STANDARDS
# Euro Area, U2 

bls_consumer_cstd1<- bls_consumer_cstd1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.DE.ALL..H.C..ST.S.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_cstd = date_convert(bls_consumer_cstd )

factors = c("Z","LP","MF","BSC","CP","GEA","RCD","CWC","NBC","BC","RTO")

bls_consumer_cstd = bls_consumer_cstd %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, BSC, CP, na.rm = T)/4, 
         "Risk perceptions" = sum(GEA, RCD, CWC, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, na.rm = T )/2, 
         "Banks' Risk tolerance" = (RTO)) %>%
  select(-c("LP","MF","BSC","CP","GEA","RCD","CWC","NBC","BC","RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z",  "TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_consumer_cstd,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_consumer_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Germany, Consumer Credit Standards, breakdown factors, full time series")

```

### Spain, full series (Q2 2024)

```{r}

series_key <- "Q.ES.ALL.Z.H.C..ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_cstd1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_cstd1 = date_convert(bls_consumer_cstd1)

bls_consumer_cstd1= bls_consumer_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_consumer_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Spain, Consumer/ Credit standards, full time series")+
  theme_bw()

write.csv(bls_consumer_cstd1, "FR_Cons_Crst.csv")

```

### Spain, breakdown (Q2 2024)

```{r}

# CONSUMER CREDIT STANDARDS
# Euro Area, U2 

bls_consumer_cstd1<- bls_consumer_cstd1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.ES.ALL..H.C..ST.S.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_cstd = date_convert(bls_consumer_cstd )

factors = c("Z","LP","MF","BSC","CP","GEA","RCD","CWC","NBC","BC","RTO")

bls_consumer_cstd = bls_consumer_cstd %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, BSC, CP, na.rm = T)/4, 
         "Risk perceptions" = sum(GEA, RCD, CWC, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, na.rm = T )/2, 
         "Banks' Risk tolerance" = (RTO)) %>%
  select(-c("LP","MF","BSC","CP","GEA","RCD","CWC","NBC","BC","RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z",  "TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_consumer_cstd,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_consumer_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Spain, Consumer Credit Standards, breakdown factors, full time series")

```

### Italy, full series (Q2 2024)

```{r}

series_key <- "Q.IT.ALL.Z.H.C..ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_cstd1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_cstd1 = date_convert(bls_consumer_cstd1)

bls_consumer_cstd1= bls_consumer_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_consumer_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Italy, Consumer/ Credit standards, full time series")+
  theme_bw()

write.csv(bls_consumer_cstd1, "IT_Cons_Crst.csv")

```

### Italy, breakdown (Q2 2024)

```{r}

# CONSUMER CREDIT STANDARDS
# Euro Area, U2 

bls_consumer_cstd1<- bls_consumer_cstd1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.IT.ALL..H.C..ST.S.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_cstd = date_convert(bls_consumer_cstd )

factors = c("Z","LP","MF","BSC","CP","GEA","RCD","CWC","NBC","BC","RTO")

bls_consumer_cstd = bls_consumer_cstd %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, BSC, CP, na.rm = T)/4, 
         "Risk perceptions" = sum(GEA, RCD, CWC, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, na.rm = T )/2, 
         "Banks' Risk tolerance" = (RTO)) %>%
  select(-c("LP","MF","BSC","CP","GEA","RCD","CWC","NBC","BC","RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z",  "TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_consumer_cstd,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_consumer_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Italy, Consumer Credit Standards, breakdown factors, full time series")

```

### Ireland, full series (Q2 2024)

```{r}

series_key <- "Q.IE.ALL.Z.H.C..ST.S.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_cstd1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_cstd1 = date_convert(bls_consumer_cstd1)

bls_consumer_cstd1= bls_consumer_cstd1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_consumer_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Ireland, Consumer/ Credit standards, full time series")+
  theme_bw()

write.csv(bls_consumer_cstd1, "IE_Cons_Crst.csv")

```

### Ireland, breakdown (Q2 2024)

```{r}

# CONSUMER CREDIT STANDARDS
# Euro Area, U2 

bls_consumer_cstd1<- bls_consumer_cstd1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.IE.ALL..H.C..ST.S.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_cstd = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_cstd = date_convert(bls_consumer_cstd )

factors = c("Z","LP","MF","BSC","CP","GEA","RCD","CWC","NBC","BC","RTO")

bls_consumer_cstd = bls_consumer_cstd %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Cost of funds and balance sheet constraints" = sum(LP, MF, BSC, CP, na.rm = T)/4, 
         "Risk perceptions" = sum(GEA, RCD, CWC, na.rm = T)/3, 
         "Competition" = sum(NBC, BC, na.rm = T )/2, 
         "Banks' Risk tolerance" = (RTO)) %>%
  select(-c("LP","MF","BSC","CP","GEA","RCD","CWC","NBC","BC","RTO")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z",  "TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_consumer_cstd,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_consumer_cstd1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Ireland, Consumer Credit Standards, breakdown factors, full time series")

```

## Section 3.2 Demand

### Euro area, full series (Q2 2024)

```{r}

series_key <- "Q.U2.ALL.Z.H.C..ZZ.D.WFNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_demand1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_demand1 = date_convert(bls_consumer_demand1)

bls_consumer_demand1= bls_consumer_demand1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_consumer_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Euro Area, Consumer/ Demand, full time series")+
  theme_bw()

write.csv(bls_consumer_demand1, "EA_Cons_demand.csv")

```

### Euro Area, breakdown (Q2 2024)

```{r}

# Demand / Consumer: contributing factors to change in demand 
# Euro area

bls_consumer_demand1<- bls_consumer_demand1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.U2.ALL..H.C..ZZ.D.WFNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_demand = date_convert(bls_consumer_demand)

factors = c("Z","SDC","IFS","LOB","OSF","GLI","CRE","CCF")

bls_consumer_demand = bls_consumer_demand %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Spending on durable goods" = (SDC),
         "Use of alternative finance" = sum(IFS, LOB, OSF, na.rm = T)/3, 
         "General Level of Interest Rate" = (GLI), 
         "Consumption exp.(real estate)" = (CRE),
         "Consumer Confidence"=(CCF)) %>%
  select(-c("SDC","IFS","LOB","OSF","GLI","CRE","CCF")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z","TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_consumer_demand,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_consumer_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Euro Area, Consumer/Demand, breakdown factors, full time series")

```

### France, full series (Q2 2024)

```{r}

series_key <- "Q.FR.ALL.Z.H.C..ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_demand1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_demand1 = date_convert(bls_consumer_demand1)

bls_consumer_demand1= bls_consumer_demand1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_consumer_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("France, Consumer/ Demand, full time series")+
  theme_bw()

write.csv(bls_consumer_demand1, "FR_Cons_demand.csv")

```

### France, breakdown (Q2 2024)

```{r}

# Demand / Consumer: contributing factors to change in demand 
# Euro area

bls_consumer_demand1<- bls_consumer_demand1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.FR.ALL..H.C..ZZ.D.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_demand = date_convert(bls_consumer_demand)

factors = c("Z","SDC","IFS","LOB","OSF","GLI","CRE","CCF")

bls_consumer_demand = bls_consumer_demand %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Spending on durable goods" = (SDC),
         "Use of alternative finance" = sum(IFS, LOB, OSF, na.rm = T)/3, 
         "General Level of Interest Rate" = (GLI), 
         "Consumption exp.(real estate)" = (CRE),
         "Consumer Confidence"=(CCF)) %>%
  select(-c("SDC","IFS","LOB","OSF","GLI","CRE","CCF")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z","TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_consumer_demand,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_consumer_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("France, Consumer/Demand, breakdown factors, full time series")

```

### Germany, full series (Q2 2024)

```{r}

series_key <- "Q.DE.ALL.Z.H.C..ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_demand1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_demand1 = date_convert(bls_consumer_demand1)

bls_consumer_demand1= bls_consumer_demand1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_consumer_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Germany, Consumer/ Demand, full time series")+
  theme_bw()

write.csv(bls_consumer_demand1, "DE_Cons_demand.csv")

```

### Germany, breakdown (Q2 2024)

```{r}

# Demand / Consumer: contributing factors to change in demand 
# Euro area

bls_consumer_demand1<- bls_consumer_demand1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.DE.ALL..H.C..ZZ.D.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_demand = date_convert(bls_consumer_demand)

factors = c("Z","SDC","IFS","LOB","OSF","GLI","CRE","CCF")

bls_consumer_demand = bls_consumer_demand %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Spending on durable goods" = (SDC),
         "Use of alternative finance" = sum(IFS, LOB, OSF, na.rm = T)/3, 
         "General Level of Interest Rate" = (GLI), 
         "Consumption exp.(real estate)" = (CRE),
         "Consumer Confidence"=(CCF)) %>%
  select(-c("SDC","IFS","LOB","OSF","GLI","CRE","CCF")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z","TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_consumer_demand,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_consumer_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Germany, Consumer/Demand, breakdown factors, full time series")

```

### Spain, full series (Q2 2024)

```{r}

series_key <- "Q.ES.ALL.Z.H.C..ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_demand1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_demand1 = date_convert(bls_consumer_demand1)

bls_consumer_demand1= bls_consumer_demand1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_consumer_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Spain, Consumer/ Demand, full time series")+
  theme_bw()

write.csv(bls_consumer_demand1, "ES_Cons_demand.csv")

```

### Spain, breakdown (Q2 2024)

```{r}

# Demand / Consumer: contributing factors to change in demand 
# Euro area

bls_consumer_demand1<- bls_consumer_demand1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.ES.ALL..H.C..ZZ.D.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_demand = date_convert(bls_consumer_demand)

factors = c("Z","SDC","IFS","LOB","OSF","GLI","CRE","CCF")

bls_consumer_demand = bls_consumer_demand %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Spending on durable goods" = (SDC),
         "Use of alternative finance" = sum(IFS, LOB, OSF, na.rm = T)/3, 
         "General Level of Interest Rate" = (GLI), 
         "Consumption exp.(real estate)" = (CRE),
         "Consumer Confidence"=(CCF)) %>%
  select(-c("SDC","IFS","LOB","OSF","GLI","CRE","CCF")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z","TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_consumer_demand,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_consumer_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Spain, Consumer/Demand,breakdown factors, full time series")

```

### Italy, full series (Q2 2024)

```{r}

series_key <- "Q.IT.ALL.Z.H.C..ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_demand1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_demand1 = date_convert(bls_consumer_demand1)

bls_consumer_demand1= bls_consumer_demand1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_consumer_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("France, Consumer/ Demand, full time series")+
  theme_bw()

write.csv(bls_consumer_demand1, "IT_Cons_demand.csv")

```

### Italy, breakdown (Q2 2024)

```{r}

# Demand / Consumer: contributing factors to change in demand 
# Euro area

bls_consumer_demand1<- bls_consumer_demand1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.IT.ALL..H.C..ZZ.D.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_demand = date_convert(bls_consumer_demand)

factors = c("Z","SDC","IFS","LOB","OSF","GLI","CRE","CCF")

bls_consumer_demand = bls_consumer_demand %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Spending on durable goods" = (SDC),
         "Use of alternative finance" = sum(IFS, LOB, OSF, na.rm = T)/3, 
         "General Level of Interest Rate" = (GLI), 
         "Consumption exp.(real estate)" = (CRE),
         "Consumer Confidence"=(CCF)) %>%
  select(-c("SDC","IFS","LOB","OSF","GLI","CRE","CCF")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z","TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_consumer_demand,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_consumer_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Italy, Consumer/Demand, breakdown factors, full time series")

```

### Ireland, full series (Q2 2024)

```{r}

series_key <- "Q.IE.ALL.Z.H.C..ZZ.D.FNET"

series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_demand1 = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_demand1 = date_convert(bls_consumer_demand1)

bls_consumer_demand1= bls_consumer_demand1%>%
  mutate(Date=date-months(3))%>%
  mutate(ReferenceHorizon=case_when(
    TIME_HORIZON=="B3"~"Backward Looking",
    TIME_HORIZON=="F3"~"Forward Looking"
  ))%>%
  select(Date,ReferenceHorizon,OBS_VALUE)

ggplot(data=bls_consumer_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon))+
  geom_line(aes(color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  ggtitle("Ireland, Consumer/ Demand, full time series")+
  theme_bw()

write.csv(bls_consumer_demand1, "IE_Cons_demand.csv")

```

### Ireland, breakdown (Q2 2024)

```{r}

# Demand / Consumer: contributing factors to change in demand 
# Euro area

bls_consumer_demand1<- bls_consumer_demand1%>%
  filter(Date>="2020-01-01")

series_key <- "Q.IE.ALL..H.C..ZZ.D.FNET"
series_key = paste0(series_key) 
df <- httr::GET(glue(source, series_key), config(ssl_verifypeer = FALSE), authenticate(euaccount, password), 
                verbose(), add_headers(.headers = headers))           # Note that the target file is CSV format.
df= read.csv(textConnection(content(df, 'text')))

bls_consumer_demand = df[, c("TIME_PERIOD", "OBS_VALUE", "BLS_ITEM", "TIME_HORIZON")]

bls_consumer_demand = date_convert(bls_consumer_demand)

factors = c("Z","SDC","IFS","LOB","OSF","GLI","CRE","CCF")

bls_consumer_demand = bls_consumer_demand %>%
  filter(BLS_ITEM %in% factors) %>%
  spread(BLS_ITEM, OBS_VALUE) %>%
  rowwise() %>%
  mutate("Spending on durable goods" = (SDC),
         "Use of alternative finance" = sum(IFS, LOB, OSF, na.rm = T)/3, 
         "General Level of Interest Rate" = (GLI), 
         "Consumption exp.(real estate)" = (CRE),
         "Consumer Confidence"=(CCF)) %>%
  select(-c("SDC","IFS","LOB","OSF","GLI","CRE","CCF")) %>%
  gather(key = "BLS_ITEM", val = "value", -c("Z","TIME_HORIZON", "date", "TIME_PERIOD")) %>%
  group_by(BLS_ITEM) %>%
  mutate(Date = date - months(3))%>%
  mutate(Factors=BLS_ITEM)%>%
  filter(Date>="2020-01-01")

ggplot()+
  geom_bar(data=bls_consumer_demand,aes(x=Date,y=value,fill=Factors,group=Factors),stat="Identity")+
  geom_line(data=bls_consumer_demand1,aes(x=Date,y=OBS_VALUE,group=ReferenceHorizon,color=ReferenceHorizon))+
  scale_color_manual(values=c("red","black"))+
  labs(x="Date",y="Net Percentage")+
  theme_bw()+
  ggtitle("Ireland, Consumer/Demand, breakdown factors, full time series")

```
